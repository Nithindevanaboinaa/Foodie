<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
    <link rel="stylesheet" href="/static/css/Menu.css">
    <link rel="stylesheet" href="/static/css/Home.css">
</head>
<body>
    <header>
        <div class="main-header">
            <div class="logo">
                <h1><a href="{{url_for('home')}}"><img src="/static/foodlogo.gif"></a></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="{{url_for('home')}}">Home</a></li>
                    <li><a href="{{url_for('show_menu')}}">Menu</a></li>
                    <li><a href="{{url_for('reservation')}}">Reservation</a></li>
                    <li><a href="#contact">Contact us</a></li>
                    <li><a href="#about">About us</a></li>
                    <li><a href="{{url_for('cart')}}" id="cart-icon"><img src="/static/shopping-cart.gif"></a></li>
                    <li>
                        <a href="{{ url_for('logout') }}"><input type="button" value="Logout"/></a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <h2>Our Popular Menu</h2>
        <div class="categories">
            <button data-filter="all">All categories</button>
            <button data-filter="breakfast">Breakfast</button>
            <button data-filter="lunch">Lunch</button>
            <button data-filter="dinner">Dinner</button>
            <button data-filter="dessert">Dessert</button>
            <button data-filter="drink">Drink</button>
        </div>
        <div class="menu-items">
            {% for item in menu %}
            <div class="menu-item" data-category="{{ item['category'] }}" data-name="{{ item['name'] }}" data-price="{{ item['price'] }}" data-description="{{ item['description'] }}" data-image="{{ item['image'] }}">
                <img src="{{ url_for('static', filename=item['image']) }}" alt="{{ item['name'] }}" onclick="showDetails(this)"> 
                <h3>{{ item['name'] }}</h3>
                <p>price ₹{{ item['price'] }}</p>
                <button onclick="addToCartDirectly('{{ item['name'] }}', {{ item['price'] }})">Add to Cart</button>
            </div>
            {% endfor %}
        </div>
    </main>

    <div id="item-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <img id="modal-image" src="" alt="Item Image">
            <h3 id="modal-title"></h3>
            <p id="modal-description"></p>
            <p id="modal-price"></p>
            <div class="quantity-selector">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" value="1" min="1">
            </div>
            <button onclick="addToCart()">Add to Cart</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = document.querySelectorAll('.categories button');
            const items = document.querySelectorAll('.menu-item');
            const searchBar = document.getElementById('search-bar');

            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const filter = button.getAttribute('data-filter');
                    items.forEach(item => {
                        if (filter === 'all') {
                            item.style.display = 'block';
                        } else {
                            item.style.display = item.getAttribute('data-category') === filter ? 'block' : 'none';
                        }
                    });
                });
            });

            searchBar.addEventListener('input', () => {
                const searchTerm = searchBar.value.toLowerCase();
                items.forEach(item => {
                    const itemName = item.getAttribute('data-name').toLowerCase();
                    item.style.display = itemName.includes(searchTerm) ? 'block' : 'none';
                });
            });

            updateCartCount();
        });

        function showDetails(element) {
            const item = element.closest('.menu-item');
            const name = item.getAttribute('data-name');
            const price = item.getAttribute('data-price');
            const description = item.getAttribute('data-description');
            const image = item.getAttribute('data-image');

            document.getElementById('modal-image').src = `{{ url_for('static', filename='') }}${image}`;
            document.getElementById('modal-title').textContent = name;
            document.getElementById('modal-description').textContent = description;
            document.getElementById('modal-price').textContent = `price ₹${price}`;
            document.getElementById('quantity').value = 1;

            document.getElementById('item-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('item-modal').style.display = 'none';
        }

        function addToCart() {
            const name = document.getElementById('modal-title').textContent;
            const quantity = parseInt(document.getElementById('quantity').value);
            const price = parseInt(document.getElementById('modal-price').textContent.replace('price ₹', ''));

            const item = { name, quantity, price };
            fetch('/add_to_cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(item)
            }).then(() => updateCart());

            closeModal();
        }

        function addToCartDirectly(name, price) {
            const item = { name, quantity: 1, price };
            fetch('/add_to_cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(item)
            }).then(() => updateCart());
        }

        function updateCartCount() {
            fetch('/fetch_cart')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('cart-count').textContent = data.cart.length;
                    }
                });
        }

        document.getElementById('cart-icon').addEventListener('click', () => {
            window.location.href = '{{url_for('cart')}}';
        });

    </script>
</body>
</html>
